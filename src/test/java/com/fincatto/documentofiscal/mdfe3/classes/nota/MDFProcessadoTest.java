/*
 * Copyright 2020 Edivaldo Merlo Stens.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.fincatto.documentofiscal.mdfe3.classes.nota;

import com.fincatto.documentofiscal.mdfe3.FabricaDeObjetosFakeMDFe;
import com.fincatto.documentofiscal.validadores.DFXMLValidador;
import org.junit.Assert;
import org.junit.Test;

/**
 *
 * @author Edivaldo
 */
public class MDFProcessadoTest {

    final String xmlEspected = "<mdfeProc versao=\"3.00\" schemaLocation=\"\" xmlns=\"http://www.portalfiscal.inf.br/mdfe\"><MDFe><infMDFe Id=\"MDFe33200736293264000128580010000000301045981192\" versao=\"3.00\"><ide><cUF>32</cUF><tpAmb>2</tpAmb><tpEmit>2</tpEmit><tpTransp>2</tpTransp><mod>58</mod><serie>1</serie><nMDF>123654</nMDF><cMDF>12345689</cMDF><cDV>1</cDV><modal>1</modal><dhEmi>2019-05-28T11:07:55-03:00</dhEmi><tpEmis>1</tpEmis><procEmi>0</procEmi><verProc>3.0</verProc><UFIni>RJ</UFIni><UFFim>ES</UFFim><infMunCarrega><cMunCarrega>3304557</cMunCarrega><xMunCarrega>Rio de Janeiro</xMunCarrega></infMunCarrega><dhIniViagem>2019-05-28T11:07:55-03:00</dhIniViagem></ide><emit><CNPJ>99999999999999</CNPJ><IE>9999999999</IE><xNome>XXXXXXXXXXXXXXXXXXXX</xNome><xFant>XXXXXXXXXXXXXXXX</xFant><enderEmit><xLgr>VVVVVVVVVVVVV</xLgr><nro>1234</nro><xCpl>ASDFG</xCpl><xBairro>BBBBBBBBBB</xBairro><cMun>3300100</cMun><xMun>Angra dos Reis</xMun><CEP>99999999</CEP><UF>RJ</UF><fone>9999999999</fone><email>nonono@nono.non.no</email></enderEmit></emit><infModal versaoModal=\"3.00\"><rodo><infANTT><RNTRC>87654321</RNTRC><infCIOT><CIOT>123456789123</CIOT><CNPJ>99999999999999</CNPJ></infCIOT><valePed><disp><CNPJForn>99999999999999</CNPJForn><CPFPg>99999999999</CPFPg><nCompra>999999</nCompra><vValePed>999999.99</vValePed></disp></valePed><infContratante><CNPJ>99999999999999</CNPJ></infContratante><infPag><xNome>NONONONONO NONONO</xNome><CNPJ>99999999999999</CNPJ><Comp><tpComp>99</tpComp><vComp>88888.88</vComp><xComp>COMPCOMPCOMP</xComp></Comp><vContrato>9999.99</vContrato><indPag>1</indPag><infPrazo><nParcela>001</nParcela><dVenc>2020-03-03</dVenc><vParcela>88888.88</vParcela></infPrazo><infBanc><codBanco>001</codBanco><codAgencia>1525</codAgencia></infBanc></infPag></infANTT><veicTracao><cInt>1</cInt><placa>MTX5K56</placa><RENAVAM>99999999999</RENAVAM><tara>888888</tara><capKG>13</capKG><capM3>23</capM3><prop><CPF>99999999999</CPF><RNTRC>55555555</RNTRC><xNome>NONONONO NONONONO</xNome><IE>77777777</IE><UF>ES</UF><tpProp>1</tpProp></prop><condutor><xNome>NONONONO NONONONO</xNome><CPF>99999999999</CPF></condutor><tpRod>02</tpRod><tpCar>01</tpCar><UF>ES</UF></veicTracao><veicReboque><cInt>1</cInt><placa>MTX5K56</placa><RENAVAM>9999999999</RENAVAM><tara>888888</tara><capKG>130</capKG><capM3>230</capM3><tpCar>02</tpCar><UF>ES</UF><prop><CPF>99999999999</CPF><RNTRC>55555555</RNTRC><xNome>NONONONO NONONONO</xNome><IE>77777777</IE><UF>ES</UF><tpProp>1</tpProp></prop></veicReboque></rodo></infModal><infDoc><infMunDescarga><cMunDescarga>3300100</cMunDescarga><xMunDescarga>Angra dos Reis</xMunDescarga><infCTe><chCTe>33333333333333333333333333333333333333333333</chCTe><SegCodBarra>123456789123512345678912351234567891</SegCodBarra><indReentrega>1</indReentrega><infUnidTransp><tpUnidTransp>1</tpUnidTransp><idUnidTransp>258</idUnidTransp><lacUnidTransp><nLacre>1236547890</nLacre></lacUnidTransp><infUnidCarga><tpUnidCarga>1</tpUnidCarga><idUnidCarga>5698</idUnidCarga><lacUnidCarga><nLacre>1236547890</nLacre></lacUnidCarga><qtdRat>65</qtdRat></infUnidCarga><qtdRat>56</qtdRat></infUnidTransp><peri><nONU>4567</nONU><xNomeAE>AAAAAA</xNomeAE><xClaRisco>88</xClaRisco><grEmb>79</grEmb><qTotProd>44</qTotProd><qVolTipo>33</qVolTipo></peri></infCTe><infNFe><chNFe>33333333333333333333333333333333333333333333</chNFe><SegCodBarra>123456789123512345678912351234567892</SegCodBarra><indReentrega>1</indReentrega><infUnidTransp><tpUnidTransp>1</tpUnidTransp><idUnidTransp>258</idUnidTransp><lacUnidTransp><nLacre>1236547890</nLacre></lacUnidTransp><infUnidCarga><tpUnidCarga>1</tpUnidCarga><idUnidCarga>5698</idUnidCarga><lacUnidCarga><nLacre>1236547890</nLacre></lacUnidCarga><qtdRat>65</qtdRat></infUnidCarga><qtdRat>56</qtdRat></infUnidTransp><peri><nONU>4567</nONU><xNomeAE>AAAAAA</xNomeAE><xClaRisco>88</xClaRisco><grEmb>79</grEmb><qTotProd>44</qTotProd><qVolTipo>33</qVolTipo></peri></infNFe><infMDFeTransp><chMDFe>33333333333333333333333333333333333333333333</chMDFe><indReentrega>1</indReentrega><infUnidTransp><tpUnidTransp>1</tpUnidTransp><idUnidTransp>258</idUnidTransp><lacUnidTransp><nLacre>1236547890</nLacre></lacUnidTransp><infUnidCarga><tpUnidCarga>1</tpUnidCarga><idUnidCarga>5698</idUnidCarga><lacUnidCarga><nLacre>1236547890</nLacre></lacUnidCarga><qtdRat>65</qtdRat></infUnidCarga><qtdRat>56</qtdRat></infUnidTransp><peri><nONU>4567</nONU><xNomeAE>AAAAAA</xNomeAE><xClaRisco>88</xClaRisco><grEmb>79</grEmb><qTotProd>44</qTotProd><qVolTipo>33</qVolTipo></peri></infMDFeTransp></infMunDescarga></infDoc><seg><infResp><respSeg>2</respSeg><CNPJ>12345678901234</CNPJ></infResp><infSeg><xSeg>891726585917544010862180488469</xSeg><CNPJ>12345678901234</CNPJ></infSeg><nApol>12457898653245789865</nApol><nAver>1245789865322154879865325487986532154876</nAver><nAver>1245789865322154879865325487986532154877</nAver></seg><prodPred><tpCarga>05</tpCarga><xProd>PRODUTO PRODUTO PRODUTO PRODUTO</xProd><cEAN>SEM GTIN</cEAN><NCM>12345678</NCM><infLotacao><infLocalCarrega><latitude>-11.235689</latitude><longitude>-32.986572</longitude></infLocalCarrega><infLocalDescarrega><latitude>-11.235689</latitude><longitude>-32.986572</longitude></infLocalDescarrega></infLotacao></prodPred><tot><qCTe>1</qCTe><qNFe>1</qNFe><qMDFe>1</qMDFe><vCarga>5689.69</vCarga><cUnid>02</cUnid><qCarga>456589.5800</qCarga></tot><lacres><nLacre>0987654321</nLacre></lacres><autXML><CNPJ>99999999999999</CNPJ></autXML><infAdic><infAdFisco>XSSWERTYUIPPASDSDSAFHG</infAdFisco><infCpl>PIUYTRDFBJKLMNHYUIKJNBVFCVG</infCpl></infAdic><infSolicNFF><xSolic>{&quot;id&quot;:&quot;1&quot;,&quot;nome&quot;:&quot;NONONO&quot;}</xSolic></infSolicNFF></infMDFe><infMDFeSupl><qrCodMDFe><![CDATA[https://dfe-portal.svrs.rs.gov.br/mdfe/qrCode?chMDFe=33200736293264000128580010000000301045981192&tpAmb=2]]></qrCodMDFe></infMDFeSupl><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><Reference URI=\"#MDFe33200736293264000128580010000000301045981192\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><DigestValue>DGElW+22IC8ksSISecob4b2l5QU=</DigestValue></Reference></SignedInfo><SignatureValue>hKdILXeEV/2xNpjDEMLR6USZYQF/z9WpHEFXVVwrvPAvuVrR9zpuuLA73zEj3cbwPIJ3x8SSrh5y E22MF2B/HyiE+iOVgljBoOdJY6Ox1N4yzR5Ybz4CyRjDjyj2cDiChWEe3xe/hDtIB5ZSmcsBTegq xoyi/fmfDanqnjIH9pbdej48N+4z4g3z87KBxUgh7cfoRX8YxTIGW8RPwZR6J7pCgtdBx0zxAAD8 X9A8LFYI/EgIBR8BxmAHKRnr2V8GqVKtbmJsY/PPWdsjBF1SAyvVekbvc2BqJOJNbV4IZSWVnsq0 FNWQO1sE9AZMsBseKj4/CYx9VcFRzbZp/M5phw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIH6DCCBdCgAwIBAgIQdc1vl3hPXUCnmvgAvnw0fDANBgkqhkiG9w0BAQsFADB4MQswCQYDVQQG EwJCUjETMBEGA1UEChMKSUNQLUJyYXNpbDE2MDQGA1UECxMtU2VjcmV0YXJpYSBkYSBSZWNlaXRh IEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRwwGgYDVQQDExNBQyBDZXJ0aXNpZ24gUkZCIEc1MB4X DTIwMDUyNzEzNTQwM1oXDTIxMDUyNzEzNTQwM1owgdkxCzAJBgNVBAYTAkJSMRMwEQYDVQQKDApJ Q1AtQnJhc2lsMQswCQYDVQQIDAJSSjEOMAwGA1UEBwwFTWFjYWUxNjA0BgNVBAsMLVNlY3JldGFy aWEgZGEgUmVjZWl0YSBGZWRlcmFsIGRvIEJyYXNpbCAtIFJGQjEWMBQGA1UECwwNUkZCIGUtQ05Q SiBBMTEXMBUGA1UECwwOMTE4NzEzODgwMDAxMTIxLzAtBgNVBAMMJkdMT0JPTUFSIENPTUVSQ0lB TCBMVERBOjM2MjkzMjY0MDAwMTI4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzX1v mnxpJZfSnKem+e7p16Bh5PiyjYtJ4hhlNQ8bq8hR96NlzrO+Ar72GJQcfUX1oWsd2K2SdnSzD8Q0 UdnTav+Zzu3TKQA8pIdC/tsGQqD7lN9yyxkgv7vcBHoyIf5LOX1BfdNuBpvPdHlqverzRkX7i0O9 Z2+1dZm11aqJqj6rlZ+LSEROOLBj6nPOsgIahwo8rlfpW3F851m6DtBfxULVHEa6m5AcVZKa4uDl 1KoF4C/UUJN/ka++ialk/TWt9GR9hmWEO7oEBbKzwSaAkgimVFkh0g6J+dCRYHSpZLX/makilirT a7ZJJGQPpJ9tbKjT/o1egtAeW0pZaVWdqwIDAQABo4IDCjCCAwYwgbkGA1UdEQSBsTCBrqA9BgVg TAEDBKA0BDIyNjEwMTk1NzQyMDU2NjE2NzM0MDAwMDAwMDAwMDAwMDAwMDAwMDA0MjAwOTJTU1BF U6AfBgVgTAEDAqAWBBRSRU5BVE8gRlJBTkNJU0NPIEdPTqAZBgVgTAEDA6AQBA4zNjI5MzI2NDAw MDEyOKAXBgVgTAEDB6AOBAwwMDAwMDAwMDAwMDCBGEdMT0JPTUFSQEdMT0JPTUFSLkNPTS5CUjAJ BgNVHRMEAjAAMB8GA1UdIwQYMBaAFFN9f52+0WHQILran+OJpxNzWM1CMH8GA1UdIAR4MHYwdAYG YEwBAgEMMGowaAYIKwYBBQUHAgEWXGh0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIv cmVwb3NpdG9yaW8vZHBjL0FDX0NlcnRpc2lnbl9SRkIvRFBDX0FDX0NlcnRpc2lnbl9SRkIucGRm MIG8BgNVHR8EgbQwgbEwV6BVoFOGUWh0dHA6Ly9pY3AtYnJhc2lsLmNlcnRpc2lnbi5jb20uYnIv cmVwb3NpdG9yaW8vbGNyL0FDQ2VydGlzaWduUkZCRzUvTGF0ZXN0Q1JMLmNybDBWoFSgUoZQaHR0 cDovL2ljcC1icmFzaWwub3V0cmFsY3IuY29tLmJyL3JlcG9zaXRvcmlvL2xjci9BQ0NlcnRpc2ln blJGQkc1L0xhdGVzdENSTC5jcmwwDgYDVR0PAQH/BAQDAgXgMB0GA1UdJQQWMBQGCCsGAQUFBwMC BggrBgEFBQcDBDCBrAYIKwYBBQUHAQEEgZ8wgZwwXwYIKwYBBQUHMAKGU2h0dHA6Ly9pY3AtYnJh c2lsLmNlcnRpc2lnbi5jb20uYnIvcmVwb3NpdG9yaW8vY2VydGlmaWNhZG9zL0FDX0NlcnRpc2ln bl9SRkJfRzUucDdjMDkGCCsGAQUFBzABhi1odHRwOi8vb2NzcC1hYy1jZXJ0aXNpZ24tcmZiLmNl cnRpc2lnbi5jb20uYnIwDQYJKoZIhvcNAQELBQADggIBAKm3NO8lmyabocQTKdfD2/7URoLF7Jie qkKChvgPRfXTcS5vuoAbXfyAHwHIE9vinS0NegjcOAtpsWtY0dm4A4zxiPom9TKz2fQSH2qCYOxm d6DH4i0QTZS9sqjX8WMiLpAj0KgbjH1L7QUfe0y3TKTM5c37ZN0Wn6URW16vfY/SHPHGz5hWIW0K 4Dsr2H2AXikixfwGekoBTyGvRy7waqmiNU2DPNndDTyS79IoDc+wzuNG5cehljMpgPHi1DlikD3o UPW6MMrQpwjJsejj0+6lzR72zDwOcB1B7Sv8zNEjcqekkx89xaKQAVz3S1moUbLvPXE+b6i4ZYAM LQoIng8w3eyDzfucxwPevjFxePniRM5aLhEG7ArQWdKoc9SgovEg1prT2QA5JrZfeS3jHywel+tC pwz06aM7aBMXUvNVlMzia0ixgHT7S00zzs7YeRE4CxLzX/0imn9nl5G9cfOrOyUPm61x/m4fzyGO 1jc3vlv3KNRdzvAKQecpLTxAuIU1v0J0vUjSjjKpbtFmHrLrsCQHhPCqcgKAgV7UdU/FZtaIDr+G 8xho1HSuXGi+klzQXdPE7QGJw8rnVAUMo75vkfihYtZQpjLypfQGtlcuXdC9XOQdbIGjWqrZYmHh O7z7O+bKzTEIMG5C9M0wJU2KzK+2jspLWHJCw4zHUIsq</X509Certificate></X509Data></KeyInfo></Signature></MDFe><protMDFe versao=\"3.00\"><infProt><tpAmb>2</tpAmb><verAplic>RS20200626134456</verAplic><chMDFe>33200736293264000128580010000000301045981192</chMDFe><dhRecbto>2020-07-02T23:29:33-03:00</dhRecbto><nProt>999999999999999</nProt><digVal>DGElW+22IC8ksSISecob4b2l5QU=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso do MDF-e</xMotivo></infProt></protMDFe></mdfeProc>";
    final String xmlActual = FabricaDeObjetosFakeMDFe.getMDFProcessado().toString();

    @Test
    public void deveGerarXMLDeAcordoComOPadraoEstabelecido() {
        Assert.assertEquals(xmlEspected, xmlActual);
    }

    @Test
    public void deveValidarMDFeProcessado() throws Exception {
        Assert.assertTrue(DFXMLValidador.validaMDFeProcessado(xmlActual.replace("schemaLocation=\"\" ", "")));
    }
}
